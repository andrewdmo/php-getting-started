<html>
<head>
<title>Form_validation.php</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #606366; font-weight: normal; font-style: normal; }
.s0 { color: rgb(204,120,50); font-weight: bold; }
.s1 { color: rgb(169,183,198); }
.s2 { color: rgb(169,183,198); }
.s3 { color: rgb(106,135,89); }
.s4 { color: rgb(204,120,50); }
.s5 { color: rgb(98,151,85); font-style: italic; }
.s6 { color: rgb(98,151,85); font-weight: bold; font-style: italic; }
.s7 { color: rgb(128,128,128); }
.s8 { color: rgb(152,118,170); }
.s9 { color: rgb(104,151,187); }
.s10 { color: rgb(169,183,198); }
.ls0 { height: 1px; border-width: 0; color: rgb(77,77,77); background-color:rgb(77,77,77)}
</style>
</head>
<BODY BGCOLOR="#2b2b2b">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
Form_validation.php</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">&lt;?php if </span><span class="s1">( ! </span><span class="s2">defined</span><span class="s1">(</span><span class="s3">'BASEPATH'</span><span class="s1">)) </span><span class="s0">exit</span><span class="s1">(</span><span class="s3">'No direct script access allowed'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
</span><span class="s5">/** 
 * ExpressionEngine - by EllisLab 
 * 
 * </span><span class="s6">@package     </span><span class="s5">ExpressionEngine 
 * </span><span class="s6">@author      </span><span class="s5">EllisLab Dev Team 
 * </span><span class="s6">@copyright   </span><span class="s5">Copyright (c) 2003 - 2016, EllisLab, Inc. 
 * </span><span class="s6">@license     https://expressionengine.com/license</span><span class="s5"> 
 * </span><span class="s6">@link        https://ellislab.com</span><span class="s5"> 
 * </span><span class="s6">@since       </span><span class="s5">Version 2.0 
 * </span><span class="s6">@filesource</span><span class="s5"> 
 */</span><span class="s1"> 
 
</span><span class="s7">// ------------------------------------------------------------------------</span><span class="s1"> 
 <hr class="ls0"></span><span class="s5">/** 
 * ExpressionEngine Form Validation Class 
 * 
 * </span><span class="s6">@package     </span><span class="s5">ExpressionEngine 
 * </span><span class="s6">@subpackage  </span><span class="s5">Libraries 
 * </span><span class="s6">@category    </span><span class="s5">Validation 
 * </span><span class="s6">@author      </span><span class="s5">EllisLab Dev Team 
 * </span><span class="s6">@link        https://ellislab.com</span><span class="s5"> 
 */</span><span class="s1"> 
</span><span class="s0">class </span><span class="s2">EE_Form_validation </span><span class="s1">{ 
 
    </span><span class="s0">var </span><span class="s8">$CI</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s0">var </span><span class="s8">$_field_data            </span><span class="s1">= </span><span class="s0">array</span><span class="s1">()</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s0">var </span><span class="s8">$_config_rules          </span><span class="s1">= </span><span class="s0">array</span><span class="s1">()</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s0">var </span><span class="s8">$_error_array           </span><span class="s1">= </span><span class="s0">array</span><span class="s1">()</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s0">var </span><span class="s8">$_error_messages        </span><span class="s1">= </span><span class="s0">array</span><span class="s1">()</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s0">var </span><span class="s8">$_error_prefix          </span><span class="s1">= </span><span class="s3">'&lt;em class=&quot;ee-form-error-message&quot;&gt;'</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s0">var </span><span class="s8">$_error_suffix          </span><span class="s1">= </span><span class="s3">'&lt;/em&gt;'</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s0">var </span><span class="s8">$error_string           </span><span class="s1">= </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s0">var </span><span class="s8">$_safe_form_data        </span><span class="s1">= </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s0">var </span><span class="s8">$old_values             </span><span class="s1">= </span><span class="s0">array</span><span class="s1">()</span><span class="s4">;</span><span class="s1"> 
    </span><span class="s0">var </span><span class="s8">$_fieldtype             </span><span class="s1">= </span><span class="s2">NULL</span><span class="s4">;</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Constructor 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">__construct</span><span class="s1">(</span><span class="s8">$rules </span><span class="s1">= </span><span class="s0">array</span><span class="s1">()) 
    { 
        </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">CI </span><span class="s1">= </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">get</span><span class="s1">(</span><span class="s3">'__legacy_controller'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s7">// Validation rules can be stored in a config file.</span><span class="s1"> 
        </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_config_rules </span><span class="s1">= </span><span class="s8">$rules</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s7">// Automatically load the form helper</span><span class="s1"> 
        </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">load</span><span class="s1">-&gt;</span><span class="s2">helper</span><span class="s1">(</span><span class="s3">'form'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s7">// Set the character encoding in MB.</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">function_exists</span><span class="s1">(</span><span class="s3">'mb_internal_encoding'</span><span class="s1">)) 
        { 
            </span><span class="s2">mb_internal_encoding</span><span class="s1">(</span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">config</span><span class="s1">-&gt;</span><span class="s2">item</span><span class="s1">(</span><span class="s3">'charset'</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">input</span><span class="s1">-&gt;</span><span class="s2">get</span><span class="s1">(</span><span class="s3">'C'</span><span class="s1">) == </span><span class="s3">'addons_modules' </span><span class="s1">&amp;&amp; 
            </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">input</span><span class="s1">-&gt;</span><span class="s2">get</span><span class="s1">(</span><span class="s3">'M'</span><span class="s1">) == </span><span class="s3">'show_module_cp' </span><span class="s1">&amp;&amp; 
            </span><span class="s0">isset</span><span class="s1">(</span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">_mcp_reference</span><span class="s1">) 
        ) 
        { 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">setCallbackObject</span><span class="s1">(</span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">_mcp_reference</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
        } 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Sets the callback object 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">obj $obj    The object to use for callbacks 
     * </span><span class="s6">@return  </span><span class="s5">void 
     */</span><span class="s1"> 
    </span><span class="s0">public function </span><span class="s2">setCallbackObject</span><span class="s1">(</span><span class="s8">$obj</span><span class="s1">) 
    { 
        </span><span class="s8">$obj</span><span class="s1">-&gt;</span><span class="s2">lang </span><span class="s1">=&amp; </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s8">$obj</span><span class="s1">-&gt;</span><span class="s2">input </span><span class="s1">=&amp; </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">input</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s8">$obj</span><span class="s1">-&gt;</span><span class="s2">security </span><span class="s1">=&amp; </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">security</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">CI </span><span class="s1">=&amp; </span><span class="s8">$obj</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Handles validations that are performed over AJAX 
     * 
     * This ultimately calls our parent run() method where all validation 
     * happens, but this handles validation of single fields and the 
     * sending of AJAX responses so our controllers don't have to. 
     * 
     * </span><span class="s6">@return  </span><span class="s5">void 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">run_ajax</span><span class="s1">() 
    { 
        </span><span class="s8">$result </span><span class="s1">= (</span><span class="s2">count</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s7">// We should currently only be validating one field at a time,</span><span class="s1"> 
        </span><span class="s7">// and this POST field should have the name of it</span><span class="s1"> 
        </span><span class="s8">$field </span><span class="s1">= </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">input</span><span class="s1">-&gt;</span><span class="s2">post</span><span class="s1">(</span><span class="s3">'ee_fv_field'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s7">// Remove any namespacing to run validation for the parent field</span><span class="s1"> 
        </span><span class="s8">$field </span><span class="s1">= </span><span class="s2">preg_replace</span><span class="s1">(</span><span class="s3">'/\[.+?\]/'</span><span class="s4">, </span><span class="s3">''</span><span class="s4">, </span><span class="s8">$field</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s7">// Unset any other rules that aren't for the field we want to</span><span class="s1"> 
        </span><span class="s7">// validate</span><span class="s1"> 
        </span><span class="s0">foreach </span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data </span><span class="s0">as </span><span class="s8">$key </span><span class="s1">=&gt; </span><span class="s8">$value</span><span class="s1">) 
        { 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$key </span><span class="s1">!= </span><span class="s8">$field</span><span class="s1">) 
            { 
                </span><span class="s0">unset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$key</span><span class="s1">])</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
 
        </span><span class="s7">// Skip validation if we've emptied the field_data array,</span><span class="s1"> 
        </span><span class="s7">// can happen if we're not validating the requested field</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s0">empty</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">) &amp;&amp; </span><span class="s8">$result</span><span class="s1">) 
        { 
            </span><span class="s8">$result </span><span class="s1">= </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// Validate the field</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$result </span><span class="s1">!== </span><span class="s2">TRUE</span><span class="s1">) 
        { 
            </span><span class="s8">$result </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">run</span><span class="s1">()</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// Send appropriate AJAX response based on validation result</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$result </span><span class="s1">=== </span><span class="s2">FALSE</span><span class="s1">) 
        { 
            </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">output</span><span class="s1">-&gt;</span><span class="s2">send_ajax_response</span><span class="s1">(</span><span class="s0">array</span><span class="s1">(</span><span class="s3">'error' </span><span class="s1">=&gt; </span><span class="s2">form_error</span><span class="s1">(</span><span class="s8">$field</span><span class="s1">)))</span><span class="s4">;</span><span class="s1"> 
        } 
        </span><span class="s0">else</span><span class="s1"> 
        { 
            </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">output</span><span class="s1">-&gt;</span><span class="s2">send_ajax_response</span><span class="s1">(</span><span class="s3">'success'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
        } 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Returns TRUE/FALSE based on existance of validation errors 
     * 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">public function </span><span class="s2">errors_exist</span><span class="s1">() 
    { 
        </span><span class="s0">return </span><span class="s1">! </span><span class="s0">empty</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_array</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Given a &quot;sections&quot; array formatted for the shared form view, sets 
     * validation rules for fields that have defined options to make sure 
     * only those defined options make it through POST, this is to keep out 
     * form-tinkerers 
     * 
     * </span><span class="s6">@param   </span><span class="s5">array   $sections   Array of sections passed to form view 
     */</span><span class="s1"> 
    </span><span class="s0">public function </span><span class="s2">validateNonTextInputs</span><span class="s1">(</span><span class="s8">$sections</span><span class="s1">) 
    { 
        </span><span class="s0">foreach </span><span class="s1">(</span><span class="s8">$sections </span><span class="s0">as </span><span class="s8">$settings</span><span class="s1">) 
        { 
            </span><span class="s0">foreach </span><span class="s1">(</span><span class="s8">$settings </span><span class="s0">as </span><span class="s8">$setting</span><span class="s1">) 
            { 
                </span><span class="s0">if </span><span class="s1">(</span><span class="s2">is_array</span><span class="s1">(</span><span class="s8">$setting</span><span class="s1">)) 
                { 
                    </span><span class="s0">foreach </span><span class="s1">(</span><span class="s8">$setting</span><span class="s1">[</span><span class="s3">'fields'</span><span class="s1">] </span><span class="s0">as </span><span class="s8">$field_name </span><span class="s1">=&gt; </span><span class="s8">$field</span><span class="s1">) 
                    { 
                        </span><span class="s8">$enum </span><span class="s1">= </span><span class="s2">NULL</span><span class="s4">;</span><span class="s1"> 
 
                        </span><span class="s7">// If this field has 'choices', make sure only those</span><span class="s1"> 
                        </span><span class="s7">// choices are let through the submission</span><span class="s1"> 
                        </span><span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$field</span><span class="s1">[</span><span class="s3">'choices'</span><span class="s1">])) 
                        { 
                            </span><span class="s8">$enum </span><span class="s1">= </span><span class="s2">implode</span><span class="s1">(</span><span class="s3">','</span><span class="s4">, </span><span class="s2">array_keys</span><span class="s1">(</span><span class="s8">$field</span><span class="s1">[</span><span class="s3">'choices'</span><span class="s1">]))</span><span class="s4">;</span><span class="s1"> 
                        } 
                        </span><span class="s7">// Only allow y/n through for yes_no fields</span><span class="s1"> 
                        </span><span class="s0">elseif </span><span class="s1">(</span><span class="s8">$field</span><span class="s1">[</span><span class="s3">'type'</span><span class="s1">] == </span><span class="s3">'yes_no'</span><span class="s1">) 
                        { 
                            </span><span class="s8">$enum </span><span class="s1">= </span><span class="s3">'y,n'</span><span class="s4">;</span><span class="s1"> 
                        } 
 
                        </span><span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$enum</span><span class="s1">)) 
                        { 
                            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_rules</span><span class="s1">( 
                                </span><span class="s8">$field_name</span><span class="s4">,</span><span class="s1"> 
                                </span><span class="s8">$setting</span><span class="s1">[</span><span class="s3">'title'</span><span class="s1">]</span><span class="s4">,</span><span class="s1"> 
                                </span><span class="s3">'enum['</span><span class="s1">.</span><span class="s8">$enum</span><span class="s1">.</span><span class="s3">']'</span><span class="s1"> 
                            )</span><span class="s4">;</span><span class="s1"> 
                        } 
                    } 
                } 
            } 
        } 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Set Rules 
     * 
     * This function takes an array of field names and validation 
     * rules as input, validates the info, and stores it 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">mixed 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">void 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">set_rules</span><span class="s1">(</span><span class="s8">$field</span><span class="s4">, </span><span class="s8">$label </span><span class="s1">= </span><span class="s3">''</span><span class="s4">, </span><span class="s8">$rules </span><span class="s1">= </span><span class="s3">''</span><span class="s1">) 
    { 
        </span><span class="s7">// No reason to set rules if we have no POST data</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">count</span><span class="s1">(</span><span class="s8">$_POST</span><span class="s1">) == </span><span class="s9">0</span><span class="s1">) 
        { 
            </span><span class="s0">return </span><span class="s8">$this</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// If an array was passed via the first parameter instead of indidual string</span><span class="s1"> 
        </span><span class="s7">// values we cycle through it and recursively call this function.</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">is_array</span><span class="s1">(</span><span class="s8">$field</span><span class="s1">)) 
        { 
            </span><span class="s0">foreach </span><span class="s1">(</span><span class="s8">$field </span><span class="s0">as </span><span class="s8">$row</span><span class="s1">) 
            { 
                </span><span class="s7">// Houston, we have a problem...</span><span class="s1"> 
                </span><span class="s0">if </span><span class="s1">( ! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]) </span><span class="s0">OR </span><span class="s1">! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'rules'</span><span class="s1">])) 
                { 
                    </span><span class="s0">continue</span><span class="s4">;</span><span class="s1"> 
                } 
 
                </span><span class="s7">// If the field label wasn't passed we use the field name</span><span class="s1"> 
                </span><span class="s8">$label </span><span class="s1">= ( ! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'label'</span><span class="s1">])) ? </span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">] : </span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'label'</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
 
                </span><span class="s7">// Here we go!</span><span class="s1"> 
                </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_rules</span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]</span><span class="s4">, </span><span class="s8">$label</span><span class="s4">, </span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'rules'</span><span class="s1">])</span><span class="s4">;</span><span class="s1"> 
            } 
            </span><span class="s0">return </span><span class="s8">$this</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// No fields? Nothing to do...</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s2">is_string</span><span class="s1">(</span><span class="s8">$field</span><span class="s1">) </span><span class="s0">OR  </span><span class="s1">! </span><span class="s2">is_string</span><span class="s1">(</span><span class="s8">$rules</span><span class="s1">) </span><span class="s0">OR </span><span class="s8">$field </span><span class="s1">== </span><span class="s3">''</span><span class="s1">) 
        { 
            </span><span class="s0">return </span><span class="s8">$this</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// If the field label wasn't passed we use the field name</span><span class="s1"> 
        </span><span class="s8">$label </span><span class="s1">= (</span><span class="s8">$label </span><span class="s1">== </span><span class="s3">''</span><span class="s1">) ? </span><span class="s8">$field </span><span class="s1">: </span><span class="s8">$label</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s7">// Is the field name an array?  We test for the existence of a bracket &quot;[&quot; in</span><span class="s1"> 
        </span><span class="s7">// the field name to determine this.  If it is an array, we break it apart</span><span class="s1"> 
        </span><span class="s7">// into its components so that we can fetch the corresponding POST data later</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">strpos</span><span class="s1">(</span><span class="s8">$field</span><span class="s4">, </span><span class="s3">'['</span><span class="s1">) !== </span><span class="s2">FALSE </span><span class="s0">AND </span><span class="s2">preg_match_all</span><span class="s1">(</span><span class="s3">'/\[(.*?)\]/'</span><span class="s4">, </span><span class="s8">$field</span><span class="s4">, </span><span class="s8">$matches</span><span class="s1">)) 
        { 
            </span><span class="s7">// Note: Due to a bug in current() that affects some versions</span><span class="s1"> 
            </span><span class="s7">// of PHP we can not pass function call directly into it</span><span class="s1"> 
            </span><span class="s8">$x </span><span class="s1">= </span><span class="s2">explode</span><span class="s1">(</span><span class="s3">'['</span><span class="s4">, </span><span class="s8">$field</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s8">$indexes</span><span class="s1">[] = </span><span class="s2">current</span><span class="s1">(</span><span class="s8">$x</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
            </span><span class="s0">for </span><span class="s1">(</span><span class="s8">$i </span><span class="s1">= </span><span class="s9">0</span><span class="s4">; </span><span class="s8">$i </span><span class="s1">&lt; </span><span class="s2">count</span><span class="s1">(</span><span class="s8">$matches</span><span class="s1">[</span><span class="s3">'0'</span><span class="s1">])</span><span class="s4">; </span><span class="s8">$i</span><span class="s1">++) 
            { 
                </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$matches</span><span class="s1">[</span><span class="s3">'1'</span><span class="s1">][</span><span class="s8">$i</span><span class="s1">] != </span><span class="s3">''</span><span class="s1">) 
                { 
                    </span><span class="s8">$indexes</span><span class="s1">[] = </span><span class="s8">$matches</span><span class="s1">[</span><span class="s3">'1'</span><span class="s1">][</span><span class="s8">$i</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
                } 
            } 
 
            </span><span class="s8">$is_array </span><span class="s1">= </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
        } 
        </span><span class="s0">else</span><span class="s1"> 
        { 
            </span><span class="s8">$indexes    </span><span class="s1">= </span><span class="s0">array</span><span class="s1">()</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s8">$is_array   </span><span class="s1">= </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// Build our master array</span><span class="s1"> 
        </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">] = </span><span class="s0">array</span><span class="s1">( 
                                            </span><span class="s3">'field'             </span><span class="s1">=&gt; </span><span class="s8">$field</span><span class="s4">,</span><span class="s1"> 
                                            </span><span class="s3">'label'             </span><span class="s1">=&gt; </span><span class="s8">$label</span><span class="s4">,</span><span class="s1"> 
                                            </span><span class="s3">'rules'             </span><span class="s1">=&gt; </span><span class="s8">$rules</span><span class="s4">,</span><span class="s1"> 
                                            </span><span class="s3">'is_array'          </span><span class="s1">=&gt; </span><span class="s8">$is_array</span><span class="s4">,</span><span class="s1"> 
                                            </span><span class="s3">'keys'              </span><span class="s1">=&gt; </span><span class="s8">$indexes</span><span class="s4">,</span><span class="s1"> 
                                            </span><span class="s3">'postdata'          </span><span class="s1">=&gt; </span><span class="s2">NULL</span><span class="s4">,</span><span class="s1"> 
                                            </span><span class="s3">'error'             </span><span class="s1">=&gt; </span><span class="s3">''</span><span class="s1"> 
                                            )</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">return </span><span class="s8">$this</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Validate Username 
     * 
     * Calls the custom field validation 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@param   </span><span class="s5">string  update / new 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">call_field_validation</span><span class="s1">(</span><span class="s8">$data</span><span class="s4">, </span><span class="s8">$field_id</span><span class="s1">) 
    { 
        </span><span class="s8">$error </span><span class="s1">= </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s8">$value </span><span class="s1">= </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s8">$exists </span><span class="s1">= </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">api_channel_fields</span><span class="s1">-&gt;</span><span class="s2">setup_handler</span><span class="s1">(</span><span class="s8">$field_id</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s8">$exists</span><span class="s1">) 
        { 
            </span><span class="s0">return </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s8">$res </span><span class="s1">= </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">api_channel_fields</span><span class="s1">-&gt;</span><span class="s2">apply</span><span class="s1">(</span><span class="s3">'validate'</span><span class="s4">, </span><span class="s0">array</span><span class="s1">(</span><span class="s8">$data</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">is_array</span><span class="s1">(</span><span class="s8">$res</span><span class="s1">)) 
        { 
            </span><span class="s7">// Overwrites $error and $value if they're set</span><span class="s1"> 
            </span><span class="s7">// array('error' =&gt; ..., 'value' =&gt; ...)</span><span class="s1"> 
 
            </span><span class="s2">extract</span><span class="s1">(</span><span class="s8">$res</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
        } 
        </span><span class="s0">else</span><span class="s1"> 
        { 
            </span><span class="s8">$error </span><span class="s1">= </span><span class="s8">$res</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$error </span><span class="s1">!== </span><span class="s2">TRUE </span><span class="s1">&amp;&amp; </span><span class="s8">$error </span><span class="s1">!= </span><span class="s3">''</span><span class="s1">) 
        { 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'call_field_validation'</span><span class="s4">, </span><span class="s8">$error</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">return </span><span class="s8">$value</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Validate Username 
     * 
     * Checks if the submitted username is valid 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@param   </span><span class="s5">string  update / new 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">valid_username</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$type</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s8">$type</span><span class="s1">) 
        { 
            </span><span class="s8">$type </span><span class="s1">= </span><span class="s3">'update'</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s8">$str </span><span class="s1">= </span><span class="s2">trim_nbs</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s7">// Is username formatting correct?</span><span class="s1"> 
        </span><span class="s7">// Reserved characters:  |  &quot;  '  ! &lt; &gt; { }</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">&quot;/[</span><span class="s10">\|</span><span class="s3">'</span><span class="s4">\&quot;</span><span class="s3">!&lt;&gt;</span><span class="s10">\{\}</span><span class="s3">]/&quot;</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)) 
        { 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'valid_username'</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s3">'invalid_characters_in_username'</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// Is username min length correct?</span><span class="s1"> 
        </span><span class="s8">$len </span><span class="s1">= </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">config</span><span class="s1">-&gt;</span><span class="s2">item</span><span class="s1">(</span><span class="s3">'un_min_len'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">strlen</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) &lt; </span><span class="s8">$len</span><span class="s1">) 
        { 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'valid_username'</span><span class="s4">, </span><span class="s2">str_replace</span><span class="s1">(</span><span class="s3">'%x'</span><span class="s4">, </span><span class="s8">$len</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s3">'username_too_short'</span><span class="s1">)))</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// Is username max length correct?</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">strlen</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) &gt; </span><span class="s9">50</span><span class="s1">) 
        { 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'valid_username'</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s3">'username_too_long'</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$current </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">old_value</span><span class="s1">(</span><span class="s3">'username'</span><span class="s1">)) 
        { 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$current </span><span class="s1">!= </span><span class="s8">$str</span><span class="s1">) 
            { 
                </span><span class="s8">$type </span><span class="s1">= </span><span class="s3">'new'</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$type </span><span class="s1">== </span><span class="s3">'new'</span><span class="s1">) 
        { 
            </span><span class="s7">// Is username banned?</span><span class="s1"> 
 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">session</span><span class="s1">-&gt;</span><span class="s2">ban_check</span><span class="s1">(</span><span class="s3">'username'</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)) 
            { 
                </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'valid_username'</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s3">'username_taken'</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
                </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
            } 
 
 
            </span><span class="s7">// Is username taken?</span><span class="s1"> 
 
            </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">db</span><span class="s1">-&gt;</span><span class="s2">where</span><span class="s1">(</span><span class="s3">'username'</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s8">$count </span><span class="s1">= </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">db</span><span class="s1">-&gt;</span><span class="s2">count_all_results</span><span class="s1">(</span><span class="s3">'members'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$count </span><span class="s1">&gt; </span><span class="s9">0</span><span class="s1">) 
            { 
                </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'valid_username'</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s3">'username_taken'</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
                </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
 
        </span><span class="s0">return </span><span class="s8">$str</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Validate Screen Name 
     * 
     * Checks if the submitted screen name is valid 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">valid_screen_name</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$str </span><span class="s1">== </span><span class="s3">''</span><span class="s1">) 
        { 
            </span><span class="s0">return </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">'/[\{\}&lt;&gt;]/'</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)) 
        { 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'valid_screen_name'</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s3">'disallowed_screen_chars'</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// Is screen name banned?</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">session</span><span class="s1">-&gt;</span><span class="s2">ban_check</span><span class="s1">(</span><span class="s3">'screen_name'</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">) </span><span class="s0">OR </span><span class="s2">trim</span><span class="s1">(</span><span class="s2">preg_replace</span><span class="s1">(</span><span class="s3">&quot;/&amp;nbsp;*/&quot;</span><span class="s4">, </span><span class="s3">''</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)) == </span><span class="s3">''</span><span class="s1">) 
        { 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'valid_screen_name'</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s3">'screen_name_taken'</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">return </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Validate Password 
     * 
     * Checks if the submitted password is valid 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@param   </span><span class="s5">string  username field post key 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">valid_password</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$username_field</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s8">$username_field</span><span class="s1">) 
        { 
            </span><span class="s8">$username_field </span><span class="s1">= </span><span class="s3">'username'</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// Is password min length correct?</span><span class="s1"> 
 
        </span><span class="s8">$len </span><span class="s1">= </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">config</span><span class="s1">-&gt;</span><span class="s2">item</span><span class="s1">(</span><span class="s3">'pw_min_len'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">strlen</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) &lt; </span><span class="s8">$len</span><span class="s1">) 
        { 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'valid_password'</span><span class="s4">, </span><span class="s2">str_replace</span><span class="s1">(</span><span class="s3">'%x'</span><span class="s4">, </span><span class="s8">$len</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s3">'password_too_short'</span><span class="s1">)))</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
 
        </span><span class="s7">// Is password max length correct?</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">strlen</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) &gt; </span><span class="s2">PASSWORD_MAX_LENGTH</span><span class="s1">) 
        { 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'valid_password'</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s3">'password_too_long'</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
 
        </span><span class="s7">// Is password the same as username?</span><span class="s1"> 
        </span><span class="s7">// - We check for a reversed password as well</span><span class="s1"> 
 
        </span><span class="s8">$username </span><span class="s1">= </span><span class="s8">$_POST</span><span class="s1">[</span><span class="s8">$username_field</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s7">//  Make UN/PW lowercase for testing</span><span class="s1"> 
 
        </span><span class="s8">$lc_user </span><span class="s1">= </span><span class="s2">strtolower</span><span class="s1">(</span><span class="s8">$username</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s8">$lc_pass </span><span class="s1">= </span><span class="s2">strtolower</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s8">$nm_pass </span><span class="s1">= </span><span class="s2">strtr</span><span class="s1">(</span><span class="s8">$lc_pass</span><span class="s4">, </span><span class="s3">'elos'</span><span class="s4">, </span><span class="s3">'3105'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$lc_user </span><span class="s1">== </span><span class="s8">$lc_pass </span><span class="s0">OR </span><span class="s8">$lc_user </span><span class="s1">== </span><span class="s2">strrev</span><span class="s1">(</span><span class="s8">$lc_pass</span><span class="s1">) </span><span class="s0">OR </span><span class="s8">$lc_user </span><span class="s1">== </span><span class="s8">$nm_pass </span><span class="s0">OR </span><span class="s8">$lc_user </span><span class="s1">== </span><span class="s2">strrev</span><span class="s1">(</span><span class="s8">$nm_pass</span><span class="s1">)) 
        { 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'valid_password'</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s3">'password_based_on_username'</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
 
        </span><span class="s7">// Are secure passwords required?</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">config</span><span class="s1">-&gt;</span><span class="s2">item</span><span class="s1">(</span><span class="s3">'require_secure_passwords'</span><span class="s1">) == </span><span class="s3">'y'</span><span class="s1">) 
        { 
            </span><span class="s8">$count </span><span class="s1">= </span><span class="s0">array</span><span class="s1">(</span><span class="s3">'uc' </span><span class="s1">=&gt; </span><span class="s9">0</span><span class="s4">, </span><span class="s3">'lc' </span><span class="s1">=&gt; </span><span class="s9">0</span><span class="s4">, </span><span class="s3">'num' </span><span class="s1">=&gt; </span><span class="s9">0</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
            </span><span class="s8">$pass </span><span class="s1">= </span><span class="s2">preg_quote</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s3">&quot;/&quot;</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
            </span><span class="s8">$len </span><span class="s1">= </span><span class="s2">strlen</span><span class="s1">(</span><span class="s8">$pass</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
            </span><span class="s0">for </span><span class="s1">(</span><span class="s8">$i </span><span class="s1">= </span><span class="s9">0</span><span class="s4">; </span><span class="s8">$i </span><span class="s1">&lt; </span><span class="s8">$len</span><span class="s4">; </span><span class="s8">$i</span><span class="s1">++) 
            { 
                </span><span class="s8">$n </span><span class="s1">= </span><span class="s2">substr</span><span class="s1">(</span><span class="s8">$pass</span><span class="s4">, </span><span class="s8">$i</span><span class="s4">, </span><span class="s9">1</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
                </span><span class="s0">if </span><span class="s1">(</span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">&quot;/^[[:upper:]]$/&quot;</span><span class="s4">, </span><span class="s8">$n</span><span class="s1">)) 
                { 
                    </span><span class="s8">$count</span><span class="s1">[</span><span class="s3">'uc'</span><span class="s1">]++</span><span class="s4">;</span><span class="s1"> 
                } 
                </span><span class="s0">elseif </span><span class="s1">(</span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">&quot;/^[[:lower:]]$/&quot;</span><span class="s4">, </span><span class="s8">$n</span><span class="s1">)) 
                { 
                    </span><span class="s8">$count</span><span class="s1">[</span><span class="s3">'lc'</span><span class="s1">]++</span><span class="s4">;</span><span class="s1"> 
                } 
                </span><span class="s0">elseif </span><span class="s1">(</span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">&quot;/^[[:digit:]]$/&quot;</span><span class="s4">, </span><span class="s8">$n</span><span class="s1">)) 
                { 
                    </span><span class="s8">$count</span><span class="s1">[</span><span class="s3">'num'</span><span class="s1">]++</span><span class="s4">;</span><span class="s1"> 
                } 
            } 
 
            </span><span class="s0">foreach </span><span class="s1">(</span><span class="s8">$count </span><span class="s0">as </span><span class="s8">$val</span><span class="s1">) 
            { 
                </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$val </span><span class="s1">== </span><span class="s9">0</span><span class="s1">) 
                { 
                    </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'valid_password'</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s3">'not_secure_password'</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
                    </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
                } 
            } 
        } 
 
 
        </span><span class="s7">// Does password exist in dictionary?</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_lookup_dictionary_word</span><span class="s1">(</span><span class="s8">$lc_pass</span><span class="s1">) == </span><span class="s2">TRUE</span><span class="s1">) 
        { 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'valid_password'</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s3">'password_in_dictionary'</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">return </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Authorize Password 
     * 
     * Checks if the submitted password is valid for the logged-in user 
     * 
     * </span><span class="s6">@param   </span><span class="s5">string  $password   Password string 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">public function </span><span class="s2">auth_password</span><span class="s1">(</span><span class="s8">$password</span><span class="s1">) 
    { 
        </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">load</span><span class="s1">-&gt;</span><span class="s2">library</span><span class="s1">(</span><span class="s3">'auth'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s8">$validate </span><span class="s1">= </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">auth</span><span class="s1">-&gt;</span><span class="s2">authenticate_id</span><span class="s1">( 
            </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">session</span><span class="s1">-&gt;</span><span class="s2">userdata</span><span class="s1">(</span><span class="s3">'member_id'</span><span class="s1">)</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s8">$password</span><span class="s1"> 
        )</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">return </span><span class="s1">(</span><span class="s8">$validate </span><span class="s1">!== </span><span class="s2">FALSE</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Validate Email 
     * 
     * Checks if the submitted email is valid 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@param   </span><span class="s5">string  update / new 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">valid_user_email</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$type</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s8">$type</span><span class="s1">) 
        { 
            </span><span class="s8">$type </span><span class="s1">= </span><span class="s3">'update'</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s8">$str </span><span class="s1">= </span><span class="s2">trim_nbs</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s7">// Is email valid?</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">valid_email</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">)) 
        { 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'valid_user_email'</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s3">'invalid_email_address'</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$current </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">old_value</span><span class="s1">(</span><span class="s3">'email'</span><span class="s1">)) 
        { 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$current </span><span class="s1">!= </span><span class="s8">$str</span><span class="s1">) 
            { 
                </span><span class="s8">$type </span><span class="s1">= </span><span class="s3">'new'</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$type </span><span class="s1">== </span><span class="s3">'new'</span><span class="s1">) 
        { 
            </span><span class="s7">// Is email banned?</span><span class="s1"> 
 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">session</span><span class="s1">-&gt;</span><span class="s2">ban_check</span><span class="s1">(</span><span class="s3">'email'</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)) 
            { 
                </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'valid_user_email'</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s3">'email_taken'</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
                </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
            } 
 
            </span><span class="s7">// Duplicate emails?</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">( ! </span><span class="s2">ee</span><span class="s1">(</span><span class="s3">'Validation'</span><span class="s1">)-&gt;</span><span class="s2">check</span><span class="s1">(</span><span class="s3">'uniqueEmail'</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)) 
            { 
                </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'valid_user_email'</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s3">'email_taken'</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
                </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
 
        </span><span class="s0">return </span><span class="s8">$str</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Check to see if a date is valid by passing it to 
     * Localize::string_to_timestamp 
     * 
     * </span><span class="s6">@param  </span><span class="s5">String $date Date value to validate 
     * </span><span class="s6">@return </span><span class="s5">Boolean      TRUE if it's a date, FALSE otherwise 
     */</span><span class="s1"> 
    </span><span class="s0">public function </span><span class="s2">valid_date</span><span class="s1">(</span><span class="s8">$date</span><span class="s1">) 
    { 
        </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">load</span><span class="s1">-&gt;</span><span class="s2">library</span><span class="s1">(</span><span class="s3">'localize'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s0">return </span><span class="s1">(</span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">localize</span><span class="s1">-&gt;</span><span class="s2">string_to_timestamp</span><span class="s1">(</span><span class="s8">$date</span><span class="s4">, </span><span class="s2">TRUE</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">localize</span><span class="s1">-&gt;</span><span class="s2">get_date_format</span><span class="s1">()) != </span><span class="s2">FALSE</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Check to see if a string is unchanged after running it through 
     * Security::xss_clean() 
     * 
     * </span><span class="s6">@param  </span><span class="s5">String $string The string to validate 
     * </span><span class="s6">@return </span><span class="s5">Boolean        TRUE if it's unchanged, FALSE otherwise 
     */</span><span class="s1"> 
    </span><span class="s0">public function </span><span class="s2">valid_xss_check</span><span class="s1">(</span><span class="s8">$string</span><span class="s1">) 
    { 
        </span><span class="s8">$valid </span><span class="s1">= (</span><span class="s8">$string </span><span class="s1">== </span><span class="s2">ee</span><span class="s1">(</span><span class="s3">'Security/XSS'</span><span class="s1">)-&gt;</span><span class="s2">clean</span><span class="s1">(</span><span class="s8">$string</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s8">$valid</span><span class="s1">) 
        { 
            </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">loadfile</span><span class="s1">(</span><span class="s3">'admin'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">( 
                </span><span class="s3">'valid_xss_check'</span><span class="s4">,</span><span class="s1"> 
                </span><span class="s2">sprintf</span><span class="s1">(</span><span class="s2">lang</span><span class="s1">(</span><span class="s3">'invalid_xss_check'</span><span class="s1">)</span><span class="s4">, </span><span class="s2">ee</span><span class="s1">(</span><span class="s3">'CP/URL'</span><span class="s1">)-&gt;</span><span class="s2">make</span><span class="s1">(</span><span class="s3">'homepage'</span><span class="s1">)) 
            )</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">return </span><span class="s8">$valid</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * File exists 
     * 
     * Validation callback that checks if a file exits 
     * 
     * </span><span class="s6">@param   </span><span class="s5">string  $file   Path to file 
     * </span><span class="s6">@return  </span><span class="s5">boolean 
     */</span><span class="s1"> 
    </span><span class="s0">public function </span><span class="s2">file_exists</span><span class="s1">(</span><span class="s8">$file</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s2">file_exists</span><span class="s1">(</span><span class="s2">parse_config_variables</span><span class="s1">(</span><span class="s8">$file</span><span class="s4">, </span><span class="s8">$_POST</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Path/file writeable 
     * 
     * Validation callback that checks if a path/file is writeable 
     * 
     * </span><span class="s6">@param   </span><span class="s5">string  $path   Path or path to file file 
     * </span><span class="s6">@return  </span><span class="s5">boolean 
     */</span><span class="s1"> 
    </span><span class="s0">public function </span><span class="s2">writable</span><span class="s1">(</span><span class="s8">$path</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s2">is_really_writable</span><span class="s1">(</span><span class="s2">parse_config_variables</span><span class="s1">(</span><span class="s8">$path</span><span class="s4">, </span><span class="s8">$_POST</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Set old value 
     * 
     * Required for some rules to exclude current value from the 
     * *exists* checks (email, username, screen name) 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">mixed 
     * </span><span class="s6">@return  </span><span class="s5">void 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">set_old_value</span><span class="s1">(</span><span class="s8">$key</span><span class="s4">, </span><span class="s8">$val </span><span class="s1">= </span><span class="s3">''</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s2">is_array</span><span class="s1">(</span><span class="s8">$key</span><span class="s1">)) 
        { 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">old_values</span><span class="s1">[</span><span class="s8">$key</span><span class="s1">] = </span><span class="s8">$val</span><span class="s4">;</span><span class="s1"> 
        } 
        </span><span class="s0">else</span><span class="s1"> 
        { 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">old_values </span><span class="s1">= </span><span class="s2">array_merge </span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">old_values</span><span class="s4">, </span><span class="s8">$key</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
        } 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Get old value 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">string 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">old_value</span><span class="s1">(</span><span class="s8">$key</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">old_values</span><span class="s1">[</span><span class="s8">$key</span><span class="s1">])) ? </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">old_values</span><span class="s1">[</span><span class="s8">$key</span><span class="s1">] : </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Sets additional object to check callbacks against such as fieldtypes 
     * to allow third-party fieldtypes to validate their settings forms 
     * 
     * </span><span class="s6">@param   </span><span class="s5">object  Fieldtype to check callbacks against 
     * </span><span class="s6">@return  </span><span class="s5">void 
     */</span><span class="s1"> 
    </span><span class="s0">public function </span><span class="s2">set_fieldtype</span><span class="s1">(</span><span class="s8">$fieldtype</span><span class="s1">) 
    { 
        </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_fieldtype </span><span class="s1">= </span><span class="s8">$fieldtype</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Get the value from a form 
     * 
     * Permits you to repopulate a form field with the value it was submitted 
     * with, or, if that value doesn't exist, with the default 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string  the field name 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">void 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">set_value</span><span class="s1">(</span><span class="s8">$field </span><span class="s1">= </span><span class="s3">''</span><span class="s4">, </span><span class="s8">$default </span><span class="s1">= </span><span class="s3">''</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">])) 
        { 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$_POST</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">])) 
            { 
                </span><span class="s0">return </span><span class="s2">form_prep</span><span class="s1">(</span><span class="s8">$_POST</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">]</span><span class="s4">, </span><span class="s8">$field</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
            } 
 
            </span><span class="s0">return </span><span class="s8">$default</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">return </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">][</span><span class="s3">'postdata'</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Prep a list 
     * 
     * Unifies spaces/newlines/commas/pipes to $delim 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">string 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">prep_list</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$delim </span><span class="s1">= </span><span class="s3">&quot; &quot;</span><span class="s1">) 
    { 
        </span><span class="s8">$str </span><span class="s1">= </span><span class="s2">trim</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$delim </span><span class="s1">== </span><span class="s3">&quot; &quot;</span><span class="s1">) 
        { 
            </span><span class="s8">$str </span><span class="s1">= </span><span class="s2">preg_replace</span><span class="s1">(</span><span class="s3">&quot;/</span><span class="s4">\t</span><span class="s3">+/&quot;</span><span class="s4">, </span><span class="s3">&quot; &quot;</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s8">$str </span><span class="s1">= </span><span class="s2">preg_replace</span><span class="s1">(</span><span class="s3">&quot;/</span><span class="s10">\s</span><span class="s3">+/&quot;</span><span class="s4">, </span><span class="s3">&quot; &quot;</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s8">$str </span><span class="s1">= </span><span class="s2">preg_replace</span><span class="s1">(</span><span class="s3">&quot;/[,|]+/&quot;</span><span class="s4">, </span><span class="s3">&quot; &quot;</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s8">$str </span><span class="s1">= </span><span class="s2">str_replace</span><span class="s1">(</span><span class="s0">array</span><span class="s1">(</span><span class="s3">&quot;</span><span class="s4">\r\n</span><span class="s3">&quot;</span><span class="s4">, </span><span class="s3">&quot;</span><span class="s4">\r</span><span class="s3">&quot;</span><span class="s4">, </span><span class="s3">&quot;</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">, </span><span class="s3">&quot; &quot;</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
        } 
        </span><span class="s0">else</span><span class="s1"> 
        { 
            </span><span class="s8">$str </span><span class="s1">= </span><span class="s2">preg_replace</span><span class="s1">(</span><span class="s3">&quot;/[</span><span class="s10">\s</span><span class="s3">,|]+/&quot;</span><span class="s4">, </span><span class="s8">$delim</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s8">$str </span><span class="s1">= </span><span class="s2">trim</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$delim</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">return </span><span class="s8">$str</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Enum 
     * 
     * Check if a value is in a set 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">string 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">enum</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$opts</span><span class="s1">) 
    { 
        </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_message</span><span class="s1">(</span><span class="s3">'enum'</span><span class="s4">, </span><span class="s3">'The option you selected is not valid.'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s8">$opts </span><span class="s1">= </span><span class="s2">explode</span><span class="s1">(</span><span class="s3">','</span><span class="s4">, </span><span class="s8">$opts</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s7">// For checkboxes, for example</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">is_array</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">)) 
        { 
            </span><span class="s0">return </span><span class="s2">count</span><span class="s1">(</span><span class="s2">array_intersect</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$opts</span><span class="s1">)) == </span><span class="s2">count</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">return </span><span class="s2">in_array</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$opts</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
 
    </span><span class="s5">/** 
     * Executes the Validation routines 
     * 
     * This is almost a direct copy out of the CI Form_validation lib. 
     * however there are a couple of differences in order to work with EE. 
     * 
     * </span><span class="s6">@param   </span><span class="s5">protected 
     * </span><span class="s6">@param   </span><span class="s5">array 
     * </span><span class="s6">@param   </span><span class="s5">array 
     * </span><span class="s6">@param   </span><span class="s5">mixed 
     * </span><span class="s6">@param   </span><span class="s5">integer 
     * </span><span class="s6">@return  </span><span class="s5">mixed 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">_execute</span><span class="s1">(</span><span class="s8">$row</span><span class="s4">, </span><span class="s8">$rules</span><span class="s4">, </span><span class="s8">$postdata </span><span class="s1">= </span><span class="s2">NULL</span><span class="s4">, </span><span class="s8">$cycles </span><span class="s1">= </span><span class="s9">0</span><span class="s1">) 
    { 
        </span><span class="s7">// If the $_POST data is an array we will run a recursive call</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">is_array</span><span class="s1">(</span><span class="s8">$postdata</span><span class="s1">)) 
        { 
            </span><span class="s0">foreach </span><span class="s1">(</span><span class="s8">$postdata </span><span class="s0">as </span><span class="s8">$key </span><span class="s1">=&gt; </span><span class="s8">$val</span><span class="s1">) 
            { 
                </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_execute</span><span class="s1">(</span><span class="s8">$row</span><span class="s4">, </span><span class="s8">$rules</span><span class="s4">, </span><span class="s8">$val</span><span class="s4">, </span><span class="s8">$cycles</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
                </span><span class="s8">$cycles</span><span class="s1">++</span><span class="s4">;</span><span class="s1"> 
            } 
 
            </span><span class="s0">return</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
        </span><span class="s7">// If the field is blank, but NOT required, no further tests are necessary</span><span class="s1"> 
        </span><span class="s8">$callback </span><span class="s1">= </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s8">$ee_hack </span><span class="s1">= </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s2">in_array</span><span class="s1">(</span><span class="s3">'required'</span><span class="s4">, </span><span class="s8">$rules</span><span class="s1">) </span><span class="s0">AND </span><span class="s2">is_null</span><span class="s1">(</span><span class="s8">$postdata</span><span class="s1">)) 
        { 
            </span><span class="s7">// Before we bail out, does the rule contain a callback?</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">&quot;/(callback_</span><span class="s10">\w</span><span class="s3">+)/&quot;</span><span class="s4">, </span><span class="s2">implode</span><span class="s1">(</span><span class="s3">' '</span><span class="s4">, </span><span class="s8">$rules</span><span class="s1">)</span><span class="s4">, </span><span class="s8">$match</span><span class="s1">)) 
            { 
                </span><span class="s8">$callback </span><span class="s1">= </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
                </span><span class="s8">$rules </span><span class="s1">= (</span><span class="s0">array</span><span class="s1">(</span><span class="s3">'1' </span><span class="s1">=&gt; </span><span class="s8">$match</span><span class="s1">[</span><span class="s9">1</span><span class="s1">]))</span><span class="s4">;</span><span class="s1"> 
            } 
            </span><span class="s0">elseif </span><span class="s1">(</span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">&quot;/(call_field_validation</span><span class="s10">\[</span><span class="s3">.*?</span><span class="s10">\]</span><span class="s3">)/&quot;</span><span class="s4">, </span><span class="s2">implode</span><span class="s1">(</span><span class="s3">' '</span><span class="s4">, </span><span class="s8">$rules</span><span class="s1">)</span><span class="s4">, </span><span class="s8">$match</span><span class="s1">)) 
            { 
                </span><span class="s8">$ee_hack </span><span class="s1">= </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
                </span><span class="s8">$rules </span><span class="s1">= </span><span class="s0">array</span><span class="s1">(</span><span class="s8">$match</span><span class="s1">[</span><span class="s9">1</span><span class="s1">])</span><span class="s4">;</span><span class="s1"> 
            } 
            </span><span class="s0">else</span><span class="s1"> 
            { 
                </span><span class="s0">return</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
 
        </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
        </span><span class="s7">// Isset Test. Typically this rule will only apply to checkboxes.</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">is_null</span><span class="s1">(</span><span class="s8">$postdata</span><span class="s1">) </span><span class="s0">AND </span><span class="s8">$callback </span><span class="s1">== </span><span class="s2">FALSE </span><span class="s0">AND </span><span class="s8">$ee_hack </span><span class="s1">== </span><span class="s2">FALSE</span><span class="s1">) 
        { 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s2">in_array</span><span class="s1">(</span><span class="s3">'isset'</span><span class="s4">, </span><span class="s8">$rules</span><span class="s4">, </span><span class="s2">TRUE</span><span class="s1">) </span><span class="s0">OR </span><span class="s2">in_array</span><span class="s1">(</span><span class="s3">'required'</span><span class="s4">, </span><span class="s8">$rules</span><span class="s1">)) 
            { 
                </span><span class="s7">// Set the message type</span><span class="s1"> 
                </span><span class="s8">$type </span><span class="s1">= (</span><span class="s2">in_array</span><span class="s1">(</span><span class="s3">'required'</span><span class="s4">, </span><span class="s8">$rules</span><span class="s1">)) ? </span><span class="s3">'required' </span><span class="s1">: </span><span class="s3">'isset'</span><span class="s4">;</span><span class="s1"> 
 
                </span><span class="s0">if </span><span class="s1">( ! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_messages</span><span class="s1">[</span><span class="s8">$type</span><span class="s1">])) 
                { 
                    </span><span class="s0">if </span><span class="s1">(</span><span class="s2">FALSE </span><span class="s1">=== (</span><span class="s8">$line </span><span class="s1">= </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s8">$type</span><span class="s1">))) 
                    { 
                        </span><span class="s8">$line </span><span class="s1">= </span><span class="s3">'The field was not set'</span><span class="s4">;</span><span class="s1"> 
                    } 
                } 
                </span><span class="s0">else</span><span class="s1"> 
                { 
                    </span><span class="s8">$line </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_messages</span><span class="s1">[</span><span class="s8">$type</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
                } 
 
                </span><span class="s7">// Build the error message</span><span class="s1"> 
                </span><span class="s8">$message </span><span class="s1">= </span><span class="s2">sprintf</span><span class="s1">(</span><span class="s8">$line</span><span class="s4">, </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_translate_fieldname</span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'label'</span><span class="s1">]))</span><span class="s4">;</span><span class="s1"> 
 
                </span><span class="s7">// Save the error message</span><span class="s1"> 
                </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]][</span><span class="s3">'error'</span><span class="s1">] = </span><span class="s8">$message</span><span class="s4">;</span><span class="s1"> 
 
                </span><span class="s0">if </span><span class="s1">( ! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_array</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]])) 
                { 
                    </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_array</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]] = </span><span class="s8">$message</span><span class="s4">;</span><span class="s1"> 
                } 
            } 
 
            </span><span class="s0">return</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
        </span><span class="s7">// Cycle through each rule and run it</span><span class="s1"> 
        </span><span class="s0">foreach </span><span class="s1">(</span><span class="s8">$rules </span><span class="s0">as </span><span class="s8">$rule</span><span class="s1">) 
        { 
            </span><span class="s8">$_in_array </span><span class="s1">= </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
 
            </span><span class="s7">// We set the $postdata variable with the current data in our master array so that</span><span class="s1"> 
            </span><span class="s7">// each cycle of the loop is dealing with the processed data from the last cycle</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'is_array'</span><span class="s1">] == </span><span class="s2">TRUE </span><span class="s0">AND </span><span class="s2">is_array</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]][</span><span class="s3">'postdata'</span><span class="s1">])) 
            { 
                </span><span class="s7">// We shouldn't need this safety, but just in case there isn't an array index</span><span class="s1"> 
                </span><span class="s7">// associated with this cycle we'll bail out</span><span class="s1"> 
                </span><span class="s0">if </span><span class="s1">( ! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]][</span><span class="s3">'postdata'</span><span class="s1">][</span><span class="s8">$cycles</span><span class="s1">])) 
                { 
                    </span><span class="s0">continue</span><span class="s4">;</span><span class="s1"> 
                } 
 
                </span><span class="s8">$postdata </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]][</span><span class="s3">'postdata'</span><span class="s1">][</span><span class="s8">$cycles</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
                </span><span class="s8">$_in_array </span><span class="s1">= </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
            } 
            </span><span class="s0">else</span><span class="s1"> 
            { 
                </span><span class="s8">$postdata </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]][</span><span class="s3">'postdata'</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
            } 
 
            </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
            </span><span class="s7">// Is the rule a callback?</span><span class="s1"> 
            </span><span class="s8">$callback </span><span class="s1">= </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s2">substr</span><span class="s1">(</span><span class="s8">$rule</span><span class="s4">, </span><span class="s9">0</span><span class="s4">, </span><span class="s9">9</span><span class="s1">) == </span><span class="s3">'callback_'</span><span class="s1">) 
            { 
                </span><span class="s8">$rule </span><span class="s1">= </span><span class="s2">substr</span><span class="s1">(</span><span class="s8">$rule</span><span class="s4">, </span><span class="s9">9</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
                </span><span class="s8">$callback </span><span class="s1">= </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
            } 
 
            </span><span class="s7">// Strip the parameter (if exists) from the rule</span><span class="s1"> 
            </span><span class="s7">// Rules can contain a parameter: max_length[5]</span><span class="s1"> 
            </span><span class="s8">$param </span><span class="s1">= </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">&quot;/(.*?)</span><span class="s10">\[</span><span class="s3">(.*?)</span><span class="s10">\]</span><span class="s3">/&quot;</span><span class="s4">, </span><span class="s8">$rule</span><span class="s4">, </span><span class="s8">$match</span><span class="s1">)) 
            { 
                </span><span class="s8">$rule   </span><span class="s1">= </span><span class="s8">$match</span><span class="s1">[</span><span class="s9">1</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
                </span><span class="s8">$param  </span><span class="s1">= </span><span class="s8">$match</span><span class="s1">[</span><span class="s9">2</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
            } 
 
            </span><span class="s7">// Call the function that corresponds to the rule</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$callback </span><span class="s1">=== </span><span class="s2">TRUE</span><span class="s1">) 
            { 
                </span><span class="s7">// Check the controller for the callback first</span><span class="s1"> 
                </span><span class="s0">if </span><span class="s1">(</span><span class="s2">method_exists</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">CI</span><span class="s4">, </span><span class="s8">$rule</span><span class="s1">)) 
                { 
                    </span><span class="s8">$object </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">CI</span><span class="s4">;</span><span class="s1"> 
                } 
                </span><span class="s7">// Check fieldtype for the callback</span><span class="s1"> 
                </span><span class="s0">elseif </span><span class="s1">(</span><span class="s2">method_exists</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_fieldtype</span><span class="s4">, </span><span class="s8">$rule</span><span class="s1">)) 
                { 
                    </span><span class="s8">$object </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_fieldtype</span><span class="s4">;</span><span class="s1"> 
                } 
                </span><span class="s0">else</span><span class="s1"> 
                { 
                    </span><span class="s0">continue</span><span class="s4">;</span><span class="s1"> 
                } 
 
                </span><span class="s7">// Run the function and grab the result</span><span class="s1"> 
                </span><span class="s8">$result </span><span class="s1">= </span><span class="s8">$object</span><span class="s1">-&gt;</span><span class="s8">$rule</span><span class="s1">(</span><span class="s8">$postdata</span><span class="s4">, </span><span class="s8">$param</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
                </span><span class="s7">// Re-assign the result to the master data array</span><span class="s1"> 
                </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$_in_array </span><span class="s1">== </span><span class="s2">TRUE</span><span class="s1">) 
                { 
                    </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]][</span><span class="s3">'postdata'</span><span class="s1">][</span><span class="s8">$cycles</span><span class="s1">] = (</span><span class="s2">is_bool</span><span class="s1">(</span><span class="s8">$result</span><span class="s1">)) ? </span><span class="s8">$postdata </span><span class="s1">: </span><span class="s8">$result</span><span class="s4">;</span><span class="s1"> 
                } 
                </span><span class="s0">else</span><span class="s1"> 
                { 
                    </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]][</span><span class="s3">'postdata'</span><span class="s1">] = (</span><span class="s2">is_bool</span><span class="s1">(</span><span class="s8">$result</span><span class="s1">)) ? </span><span class="s8">$postdata </span><span class="s1">: </span><span class="s8">$result</span><span class="s4">;</span><span class="s1"> 
                } 
 
                </span><span class="s7">// If the field isn't required and we just processed a callback we'll move on...</span><span class="s1"> 
                </span><span class="s0">if </span><span class="s1">( ! </span><span class="s2">in_array</span><span class="s1">(</span><span class="s3">'required'</span><span class="s4">, </span><span class="s8">$rules</span><span class="s4">, </span><span class="s2">TRUE</span><span class="s1">) </span><span class="s0">AND </span><span class="s8">$result </span><span class="s1">!== </span><span class="s2">FALSE</span><span class="s1">) 
                { 
                    </span><span class="s0">continue</span><span class="s4">;</span><span class="s1"> 
                } 
            } 
            </span><span class="s0">else</span><span class="s1"> 
            { 
                </span><span class="s0">if </span><span class="s1">( ! </span><span class="s2">method_exists</span><span class="s1">(</span><span class="s8">$this</span><span class="s4">, </span><span class="s8">$rule</span><span class="s1">)) 
                { 
                    </span><span class="s7">// If our own wrapper function doesn't exist we see if a native PHP function does.</span><span class="s1"> 
                    </span><span class="s7">// Users can use any native PHP function call that has one param.</span><span class="s1"> 
                    </span><span class="s0">if </span><span class="s1">(</span><span class="s2">function_exists</span><span class="s1">(</span><span class="s8">$rule</span><span class="s1">)) 
                    { 
                        </span><span class="s8">$result </span><span class="s1">= </span><span class="s8">$rule</span><span class="s1">(</span><span class="s8">$postdata</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
                        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$_in_array </span><span class="s1">== </span><span class="s2">TRUE</span><span class="s1">) 
                        { 
                            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]][</span><span class="s3">'postdata'</span><span class="s1">][</span><span class="s8">$cycles</span><span class="s1">] = (</span><span class="s2">is_bool</span><span class="s1">(</span><span class="s8">$result</span><span class="s1">)) ? </span><span class="s8">$postdata </span><span class="s1">: </span><span class="s8">$result</span><span class="s4">;</span><span class="s1"> 
                        } 
                        </span><span class="s0">else</span><span class="s1"> 
                        { 
                            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]][</span><span class="s3">'postdata'</span><span class="s1">] = (</span><span class="s2">is_bool</span><span class="s1">(</span><span class="s8">$result</span><span class="s1">)) ? </span><span class="s8">$postdata </span><span class="s1">: </span><span class="s8">$result</span><span class="s4">;</span><span class="s1"> 
                        } 
                    } 
 
                    </span><span class="s0">continue</span><span class="s4">;</span><span class="s1"> 
                } 
 
                </span><span class="s8">$result </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s8">$rule</span><span class="s1">(</span><span class="s8">$postdata</span><span class="s4">, </span><span class="s8">$param</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
                </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$_in_array </span><span class="s1">== </span><span class="s2">TRUE</span><span class="s1">) 
                { 
                    </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]][</span><span class="s3">'postdata'</span><span class="s1">][</span><span class="s8">$cycles</span><span class="s1">] = (</span><span class="s2">is_bool</span><span class="s1">(</span><span class="s8">$result</span><span class="s1">)) ? </span><span class="s8">$postdata </span><span class="s1">: </span><span class="s8">$result</span><span class="s4">;</span><span class="s1"> 
                } 
                </span><span class="s0">else</span><span class="s1"> 
                { 
                    </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]][</span><span class="s3">'postdata'</span><span class="s1">] = (</span><span class="s2">is_bool</span><span class="s1">(</span><span class="s8">$result</span><span class="s1">)) ? </span><span class="s8">$postdata </span><span class="s1">: </span><span class="s8">$result</span><span class="s4">;</span><span class="s1"> 
                } 
            } 
 
            </span><span class="s7">// Did the rule test negatively?  If so, grab the error.</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$result </span><span class="s1">=== </span><span class="s2">FALSE</span><span class="s1">) 
            { 
                </span><span class="s0">if </span><span class="s1">( ! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_messages</span><span class="s1">[</span><span class="s8">$rule</span><span class="s1">])) 
                { 
                    </span><span class="s0">if </span><span class="s1">(</span><span class="s2">FALSE </span><span class="s1">=== (</span><span class="s8">$line </span><span class="s1">= </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s8">$rule</span><span class="s1">))) 
                    { 
                        </span><span class="s8">$line </span><span class="s1">= </span><span class="s3">'Unable to access an error message corresponding to your field name.'</span><span class="s4">;</span><span class="s1"> 
                    } 
                } 
                </span><span class="s0">else</span><span class="s1"> 
                { 
                    </span><span class="s8">$line </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_messages</span><span class="s1">[</span><span class="s8">$rule</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
                } 
 
                </span><span class="s7">// Is the parameter we are inserting into the error message the name</span><span class="s1"> 
                </span><span class="s7">// of another field?  If so we need to grab its &quot;field label&quot;</span><span class="s1"> 
                </span><span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$param</span><span class="s1">]) </span><span class="s0">AND isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$param</span><span class="s1">][</span><span class="s3">'label'</span><span class="s1">])) 
                { 
                    </span><span class="s8">$param </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_translate_fieldname</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$param</span><span class="s1">][</span><span class="s3">'label'</span><span class="s1">])</span><span class="s4">;</span><span class="s1"> 
                } 
 
                </span><span class="s7">// Build the error message</span><span class="s1"> 
                </span><span class="s8">$message </span><span class="s1">= </span><span class="s2">sprintf</span><span class="s1">(</span><span class="s8">$line</span><span class="s4">, </span><span class="s8">$param</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
                </span><span class="s7">// Save the error message</span><span class="s1"> 
                </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]][</span><span class="s3">'error'</span><span class="s1">] = </span><span class="s8">$message</span><span class="s4">;</span><span class="s1"> 
 
                </span><span class="s0">if </span><span class="s1">( ! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_array</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]])) 
                { 
                    </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_array</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]] = </span><span class="s8">$message</span><span class="s4">;</span><span class="s1"> 
                } 
 
                </span><span class="s0">return</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
 
    </span><span class="s5">/** 
     * Lookup Dictionary Word 
     * 
     * Checks if a word is in the dictionary 
     * 
     * </span><span class="s6">@access  </span><span class="s5">private 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@param   </span><span class="s5">string  update / new 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">_lookup_dictionary_word</span><span class="s1">(</span><span class="s8">$target</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">config</span><span class="s1">-&gt;</span><span class="s2">item</span><span class="s1">(</span><span class="s3">'allow_dictionary_pw'</span><span class="s1">) == </span><span class="s3">'y' </span><span class="s0">OR </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">config</span><span class="s1">-&gt;</span><span class="s2">item</span><span class="s1">(</span><span class="s3">'name_of_dictionary_file'</span><span class="s1">) == </span><span class="s3">''</span><span class="s1">) 
        { 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s8">$path </span><span class="s1">= </span><span class="s2">reduce_double_slashes</span><span class="s1">(</span><span class="s2">PATH_DICT</span><span class="s1">.</span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">config</span><span class="s1">-&gt;</span><span class="s2">item</span><span class="s1">(</span><span class="s3">'name_of_dictionary_file'</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s2">file_exists</span><span class="s1">(</span><span class="s8">$path</span><span class="s1">)) 
        { 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s8">$word_file </span><span class="s1">= </span><span class="s2">file</span><span class="s1">(</span><span class="s8">$path</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">foreach </span><span class="s1">(</span><span class="s8">$word_file </span><span class="s0">as </span><span class="s8">$word</span><span class="s1">) 
        { 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s2">trim</span><span class="s1">(</span><span class="s2">strtolower</span><span class="s1">(</span><span class="s8">$word</span><span class="s1">)) == </span><span class="s8">$target</span><span class="s1">) 
            { 
                </span><span class="s0">return </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
 
        </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Set Error Message 
     * 
     * Lets users set their own error messages on the fly.  Note:  The key 
     * name has to match the  function name that it corresponds to. 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">string 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">set_message</span><span class="s1">(</span><span class="s8">$lang</span><span class="s4">, </span><span class="s8">$val </span><span class="s1">= </span><span class="s3">''</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s2">is_array</span><span class="s1">(</span><span class="s8">$lang</span><span class="s1">)) 
        { 
            </span><span class="s8">$lang </span><span class="s1">= </span><span class="s0">array</span><span class="s1">(</span><span class="s8">$lang </span><span class="s1">=&gt; </span><span class="s8">$val</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_messages </span><span class="s1">= </span><span class="s2">array_merge</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_messages</span><span class="s4">, </span><span class="s8">$lang</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">return </span><span class="s8">$this</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Set The Error Delimiter 
     * 
     * Permits a prefix/suffix to be added to each error message 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">void 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">set_error_delimiters</span><span class="s1">(</span><span class="s8">$prefix </span><span class="s1">= </span><span class="s3">'&lt;p&gt;'</span><span class="s4">, </span><span class="s8">$suffix </span><span class="s1">= </span><span class="s3">'&lt;/p&gt;'</span><span class="s1">) 
    { 
        </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_prefix </span><span class="s1">= </span><span class="s8">$prefix</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_suffix </span><span class="s1">= </span><span class="s8">$suffix</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">return </span><span class="s8">$this</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Get Error Message 
     * 
     * Gets the error message associated with a particular field 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string  the field name 
     * </span><span class="s6">@return  </span><span class="s5">void 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">error</span><span class="s1">(</span><span class="s8">$field </span><span class="s1">= </span><span class="s3">''</span><span class="s4">, </span><span class="s8">$prefix </span><span class="s1">= </span><span class="s3">''</span><span class="s4">, </span><span class="s8">$suffix </span><span class="s1">= </span><span class="s3">''</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">][</span><span class="s3">'error'</span><span class="s1">]) </span><span class="s0">OR </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">][</span><span class="s3">'error'</span><span class="s1">] == </span><span class="s3">''</span><span class="s1">) 
        { 
            </span><span class="s0">return </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$prefix </span><span class="s1">== </span><span class="s3">''</span><span class="s1">) 
        { 
            </span><span class="s8">$prefix </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_prefix</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$suffix </span><span class="s1">== </span><span class="s3">''</span><span class="s1">) 
        { 
            </span><span class="s8">$suffix </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_suffix</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">return </span><span class="s8">$prefix</span><span class="s1">.</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">][</span><span class="s3">'error'</span><span class="s1">].</span><span class="s8">$suffix</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Error String 
     * 
     * Returns the error messages as a string, wrapped in the error delimiters 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">str 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">error_string</span><span class="s1">(</span><span class="s8">$prefix </span><span class="s1">= </span><span class="s3">''</span><span class="s4">, </span><span class="s8">$suffix </span><span class="s1">= </span><span class="s3">''</span><span class="s1">) 
    { 
        </span><span class="s7">// No errrors, validation passes!</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">count</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_array</span><span class="s1">) === </span><span class="s9">0</span><span class="s1">) 
        { 
            </span><span class="s0">return </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$prefix </span><span class="s1">== </span><span class="s3">''</span><span class="s1">) 
        { 
            </span><span class="s8">$prefix </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_prefix</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$suffix </span><span class="s1">== </span><span class="s3">''</span><span class="s1">) 
        { 
            </span><span class="s8">$suffix </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_suffix</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// Generate the error string</span><span class="s1"> 
        </span><span class="s8">$str </span><span class="s1">= </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
        </span><span class="s0">foreach </span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_array </span><span class="s0">as </span><span class="s8">$val</span><span class="s1">) 
        { 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$val </span><span class="s1">!= </span><span class="s3">''</span><span class="s1">) 
            { 
                </span><span class="s8">$str </span><span class="s1">.= </span><span class="s8">$prefix</span><span class="s1">.</span><span class="s8">$val</span><span class="s1">.</span><span class="s8">$suffix</span><span class="s1">.</span><span class="s3">&quot;</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
 
        </span><span class="s0">return </span><span class="s8">$str</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Run the Validator 
     * 
     * This function does all the work. 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">run</span><span class="s1">(</span><span class="s8">$group </span><span class="s1">= </span><span class="s3">''</span><span class="s1">) 
    { 
        </span><span class="s7">// Do we even have any data to process?  Mm?</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">count</span><span class="s1">(</span><span class="s8">$_POST</span><span class="s1">) == </span><span class="s9">0</span><span class="s1">) 
        { 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// Does the _field_data array containing the validation rules exist?</span><span class="s1"> 
        </span><span class="s7">// If not, we look to see if they were assigned via a config file</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">count</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">) == </span><span class="s9">0</span><span class="s1">) 
        { 
            </span><span class="s7">// No validation rules?  We're done...</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s2">count</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_config_rules</span><span class="s1">) == </span><span class="s9">0</span><span class="s1">) 
            { 
                </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
            } 
 
            </span><span class="s7">// Is there a validation rule for the particular URI being accessed?</span><span class="s1"> 
            </span><span class="s8">$uri </span><span class="s1">= (</span><span class="s8">$group </span><span class="s1">== </span><span class="s3">''</span><span class="s1">) ? </span><span class="s2">trim</span><span class="s1">(</span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">uri</span><span class="s1">-&gt;</span><span class="s2">ruri_string</span><span class="s1">()</span><span class="s4">, </span><span class="s3">'/'</span><span class="s1">) : </span><span class="s8">$group</span><span class="s4">;</span><span class="s1"> 
 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$uri </span><span class="s1">!= </span><span class="s3">'' </span><span class="s0">AND isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_config_rules</span><span class="s1">[</span><span class="s8">$uri</span><span class="s1">])) 
            { 
                </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_rules</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_config_rules</span><span class="s1">[</span><span class="s8">$uri</span><span class="s1">])</span><span class="s4">;</span><span class="s1"> 
            } 
            </span><span class="s0">else</span><span class="s1"> 
            { 
                </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">set_rules</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_config_rules</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
            } 
 
            </span><span class="s7">// We're we able to set the rules correctly?</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s2">count</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">) == </span><span class="s9">0</span><span class="s1">) 
            { 
                </span><span class="s2">log_message</span><span class="s1">(</span><span class="s3">'debug'</span><span class="s4">, </span><span class="s3">&quot;Unable to find validation rules&quot;</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
                </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
 
        </span><span class="s7">// Load the language file containing error messages</span><span class="s1"> 
        </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">load</span><span class="s1">(</span><span class="s3">'form_validation'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s7">// Cycle through the rules for each field, match the</span><span class="s1"> 
        </span><span class="s7">// corresponding $_POST item and test for errors</span><span class="s1"> 
        </span><span class="s0">foreach </span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data </span><span class="s0">as </span><span class="s8">$field </span><span class="s1">=&gt; </span><span class="s8">$row</span><span class="s1">) 
        { 
            </span><span class="s7">// Fetch the data from the corresponding $_POST array and cache it in the _field_data array.</span><span class="s1"> 
            </span><span class="s7">// Depending on whether the field name is an array or a string will determine where we get it from.</span><span class="s1"> 
 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'is_array'</span><span class="s1">] == </span><span class="s2">TRUE</span><span class="s1">) 
            { 
                </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">][</span><span class="s3">'postdata'</span><span class="s1">] = </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_reduce_array</span><span class="s1">(</span><span class="s8">$_POST</span><span class="s4">, </span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'keys'</span><span class="s1">])</span><span class="s4">;</span><span class="s1"> 
            } 
            </span><span class="s0">else</span><span class="s1"> 
            { 
                </span><span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$_POST</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">]) </span><span class="s0">AND </span><span class="s8">$_POST</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">] != </span><span class="s3">&quot;&quot;</span><span class="s1">) 
                { 
                    </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">][</span><span class="s3">'postdata'</span><span class="s1">] = </span><span class="s8">$_POST</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
                } 
            } 
 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_execute</span><span class="s1">(</span><span class="s8">$row</span><span class="s4">, </span><span class="s2">explode</span><span class="s1">(</span><span class="s3">'|'</span><span class="s4">, </span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'rules'</span><span class="s1">])</span><span class="s4">, </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">][</span><span class="s3">'postdata'</span><span class="s1">])</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// Did we end up with any errors?</span><span class="s1"> 
        </span><span class="s8">$total_errors </span><span class="s1">= </span><span class="s2">count</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_error_array</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$total_errors </span><span class="s1">&gt; </span><span class="s9">0</span><span class="s1">) 
        { 
            </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_safe_form_data </span><span class="s1">= </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// Now we need to re-set the POST data with the new, processed data</span><span class="s1"> 
        </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_reset_post_array</span><span class="s1">()</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s7">// No errors, validation passes!</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$total_errors </span><span class="s1">== </span><span class="s9">0</span><span class="s1">) 
        { 
            </span><span class="s0">return </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s7">// Validation fails</span><span class="s1"> 
        </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Traverse a multidimensional $_POST array index until the data is found 
     * 
     * </span><span class="s6">@access  </span><span class="s5">private 
     * </span><span class="s6">@param   </span><span class="s5">array 
     * </span><span class="s6">@param   </span><span class="s5">array 
     * </span><span class="s6">@param   </span><span class="s5">integer 
     * </span><span class="s6">@return  </span><span class="s5">mixed 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">_reduce_array</span><span class="s1">(</span><span class="s8">$array</span><span class="s4">, </span><span class="s8">$keys</span><span class="s4">, </span><span class="s8">$i </span><span class="s1">= </span><span class="s9">0</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">is_array</span><span class="s1">(</span><span class="s8">$array</span><span class="s1">)) 
        { 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$keys</span><span class="s1">[</span><span class="s8">$i</span><span class="s1">])) 
            { 
                </span><span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$array</span><span class="s1">[</span><span class="s8">$keys</span><span class="s1">[</span><span class="s8">$i</span><span class="s1">]])) 
                { 
                    </span><span class="s8">$array </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_reduce_array</span><span class="s1">(</span><span class="s8">$array</span><span class="s1">[</span><span class="s8">$keys</span><span class="s1">[</span><span class="s8">$i</span><span class="s1">]]</span><span class="s4">, </span><span class="s8">$keys</span><span class="s4">, </span><span class="s1">(</span><span class="s8">$i</span><span class="s1">+</span><span class="s9">1</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
                } 
                </span><span class="s0">else</span><span class="s1"> 
                { 
                    </span><span class="s0">return </span><span class="s2">NULL</span><span class="s4">;</span><span class="s1"> 
                } 
            } 
            </span><span class="s0">else</span><span class="s1"> 
            { 
                </span><span class="s0">return </span><span class="s8">$array</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
 
        </span><span class="s0">return </span><span class="s8">$array</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Re-populate the _POST array with our finalized and processed data 
     * 
     * </span><span class="s6">@access  </span><span class="s5">private 
     * </span><span class="s6">@return  </span><span class="s5">null 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">_reset_post_array</span><span class="s1">() 
    { 
        </span><span class="s0">foreach </span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data </span><span class="s0">as </span><span class="s8">$field </span><span class="s1">=&gt; </span><span class="s8">$row</span><span class="s1">) 
        { 
            </span><span class="s0">if </span><span class="s1">( ! </span><span class="s2">is_null</span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'postdata'</span><span class="s1">])) 
            { 
                </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'is_array'</span><span class="s1">] == </span><span class="s2">FALSE</span><span class="s1">) 
                { 
                    </span><span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$_POST</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]])) 
                    { 
                        </span><span class="s8">$_POST</span><span class="s1">[</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'field'</span><span class="s1">]] = </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">prep_for_form</span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'postdata'</span><span class="s1">])</span><span class="s4">;</span><span class="s1"> 
                    } 
                } 
                </span><span class="s0">else</span><span class="s1"> 
                { 
                    </span><span class="s7">// start with a reference</span><span class="s1"> 
                    </span><span class="s8">$post_ref </span><span class="s1">=&amp; </span><span class="s8">$_POST</span><span class="s4">;</span><span class="s1"> 
 
                    </span><span class="s7">// before we assign values, make a reference to the right POST key</span><span class="s1"> 
                    </span><span class="s0">if </span><span class="s1">(</span><span class="s2">count</span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'keys'</span><span class="s1">]) == </span><span class="s9">1</span><span class="s1">) 
                    { 
                        </span><span class="s8">$post_ref </span><span class="s1">=&amp; </span><span class="s8">$post_ref</span><span class="s1">[</span><span class="s2">current</span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'keys'</span><span class="s1">])]</span><span class="s4">;</span><span class="s1"> 
                    } 
                    </span><span class="s0">else</span><span class="s1"> 
                    { 
                        </span><span class="s0">foreach </span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'keys'</span><span class="s1">] </span><span class="s0">as </span><span class="s8">$val</span><span class="s1">) 
                        { 
                            </span><span class="s8">$post_ref </span><span class="s1">=&amp; </span><span class="s8">$post_ref</span><span class="s1">[</span><span class="s8">$val</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
                        } 
                    } 
 
                    </span><span class="s0">if </span><span class="s1">(</span><span class="s2">is_array</span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'postdata'</span><span class="s1">])) 
                    { 
                        </span><span class="s8">$array </span><span class="s1">= </span><span class="s0">array</span><span class="s1">()</span><span class="s4">;</span><span class="s1"> 
                        </span><span class="s0">foreach </span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'postdata'</span><span class="s1">] </span><span class="s0">as </span><span class="s8">$k </span><span class="s1">=&gt; </span><span class="s8">$v</span><span class="s1">) 
                        { 
                            </span><span class="s8">$array</span><span class="s1">[</span><span class="s8">$k</span><span class="s1">] = </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">prep_for_form</span><span class="s1">(</span><span class="s8">$v</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
                        } 
 
                        </span><span class="s8">$post_ref </span><span class="s1">= </span><span class="s8">$array</span><span class="s4">;</span><span class="s1"> 
                    } 
                    </span><span class="s0">else</span><span class="s1"> 
                    { 
                        </span><span class="s8">$post_ref </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">prep_for_form</span><span class="s1">(</span><span class="s8">$row</span><span class="s1">[</span><span class="s3">'postdata'</span><span class="s1">])</span><span class="s4">;</span><span class="s1"> 
                    } 
                } 
            } 
        } 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Translate a field name 
     * 
     * </span><span class="s6">@access  </span><span class="s5">private 
     * </span><span class="s6">@param   </span><span class="s5">string  the field name 
     * </span><span class="s6">@return  </span><span class="s5">string 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">_translate_fieldname</span><span class="s1">(</span><span class="s8">$fieldname</span><span class="s1">) 
    { 
        </span><span class="s7">// Do we need to translate the field name?</span><span class="s1"> 
        </span><span class="s7">// We look for the prefix lang: to determine this</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">substr</span><span class="s1">(</span><span class="s8">$fieldname</span><span class="s4">, </span><span class="s9">0</span><span class="s4">, </span><span class="s9">5</span><span class="s1">) == </span><span class="s3">'lang:'</span><span class="s1">) 
        { 
            </span><span class="s7">// Grab the variable</span><span class="s1"> 
            </span><span class="s8">$line </span><span class="s1">= </span><span class="s2">substr</span><span class="s1">(</span><span class="s8">$fieldname</span><span class="s4">, </span><span class="s9">5</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
            </span><span class="s7">// Were we able to translate the field name?  If not we use $line</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s2">FALSE </span><span class="s1">=== (</span><span class="s8">$fieldname </span><span class="s1">= </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">lang</span><span class="s1">-&gt;</span><span class="s2">line</span><span class="s1">(</span><span class="s8">$line</span><span class="s1">))) 
            { 
                </span><span class="s0">return </span><span class="s8">$line</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
 
        </span><span class="s0">return </span><span class="s8">$fieldname</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Set Select 
     * 
     * Enables pull-down lists to be set to the value the user 
     * selected in the event of an error 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">string 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">set_select</span><span class="s1">(</span><span class="s8">$field </span><span class="s1">= </span><span class="s3">''</span><span class="s4">, </span><span class="s8">$value </span><span class="s1">= </span><span class="s3">''</span><span class="s4">, </span><span class="s8">$default </span><span class="s1">= </span><span class="s2">FALSE</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">]) </span><span class="s0">OR </span><span class="s1">! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">][</span><span class="s3">'postdata'</span><span class="s1">])) 
        { 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$default </span><span class="s1">=== </span><span class="s2">TRUE </span><span class="s0">AND </span><span class="s2">count</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">) === </span><span class="s9">0</span><span class="s1">) 
            { 
                </span><span class="s0">return </span><span class="s3">' selected=&quot;selected&quot;'</span><span class="s4">;</span><span class="s1"> 
            } 
            </span><span class="s0">return </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s8">$field </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">][</span><span class="s3">'postdata'</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">is_array</span><span class="s1">(</span><span class="s8">$field</span><span class="s1">)) 
        { 
            </span><span class="s0">if </span><span class="s1">( ! </span><span class="s2">in_array</span><span class="s1">(</span><span class="s8">$value</span><span class="s4">, </span><span class="s8">$field</span><span class="s1">)) 
            { 
                </span><span class="s0">return </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
        </span><span class="s0">else</span><span class="s1"> 
        { 
            </span><span class="s0">if </span><span class="s1">((</span><span class="s8">$field </span><span class="s1">== </span><span class="s3">'' </span><span class="s0">OR </span><span class="s8">$value </span><span class="s1">== </span><span class="s3">''</span><span class="s1">) </span><span class="s0">OR </span><span class="s1">(</span><span class="s8">$field </span><span class="s1">!= </span><span class="s8">$value</span><span class="s1">)) 
            { 
                </span><span class="s0">return </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
 
        </span><span class="s0">return </span><span class="s3">' selected=&quot;selected&quot;'</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Set Radio 
     * 
     * Enables radio buttons to be set to the value the user 
     * selected in the event of an error 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">string 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">set_radio</span><span class="s1">(</span><span class="s8">$field </span><span class="s1">= </span><span class="s3">''</span><span class="s4">, </span><span class="s8">$value </span><span class="s1">= </span><span class="s3">''</span><span class="s4">, </span><span class="s8">$default </span><span class="s1">= </span><span class="s2">FALSE</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">]) </span><span class="s0">OR </span><span class="s1">! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">][</span><span class="s3">'postdata'</span><span class="s1">])) 
        { 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$default </span><span class="s1">=== </span><span class="s2">TRUE </span><span class="s0">AND </span><span class="s2">count</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">) === </span><span class="s9">0</span><span class="s1">) 
            { 
                </span><span class="s0">return </span><span class="s3">' checked=&quot;checked&quot;'</span><span class="s4">;</span><span class="s1"> 
            } 
            </span><span class="s0">return </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s8">$field </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">][</span><span class="s3">'postdata'</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">is_array</span><span class="s1">(</span><span class="s8">$field</span><span class="s1">)) 
        { 
            </span><span class="s0">if </span><span class="s1">( ! </span><span class="s2">in_array</span><span class="s1">(</span><span class="s8">$value</span><span class="s4">, </span><span class="s8">$field</span><span class="s1">)) 
            { 
                </span><span class="s0">return </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
        </span><span class="s0">else</span><span class="s1"> 
        { 
            </span><span class="s0">if </span><span class="s1">((</span><span class="s8">$field </span><span class="s1">== </span><span class="s3">'' </span><span class="s0">OR </span><span class="s8">$value </span><span class="s1">== </span><span class="s3">''</span><span class="s1">) </span><span class="s0">OR </span><span class="s1">(</span><span class="s8">$field </span><span class="s1">!= </span><span class="s8">$value</span><span class="s1">)) 
            { 
                </span><span class="s0">return </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
 
        </span><span class="s0">return </span><span class="s3">' checked=&quot;checked&quot;'</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Set Checkbox 
     * 
     * Enables checkboxes to be set to the value the user 
     * selected in the event of an error 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">string 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">set_checkbox</span><span class="s1">(</span><span class="s8">$field </span><span class="s1">= </span><span class="s3">''</span><span class="s4">, </span><span class="s8">$value </span><span class="s1">= </span><span class="s3">''</span><span class="s4">, </span><span class="s8">$default </span><span class="s1">= </span><span class="s2">FALSE</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">]) </span><span class="s0">OR </span><span class="s1">! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">][</span><span class="s3">'postdata'</span><span class="s1">])) 
        { 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$default </span><span class="s1">=== </span><span class="s2">TRUE </span><span class="s0">AND </span><span class="s2">count</span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">) === </span><span class="s9">0</span><span class="s1">) 
            { 
                </span><span class="s0">return </span><span class="s3">' checked=&quot;checked&quot;'</span><span class="s4">;</span><span class="s1"> 
            } 
            </span><span class="s0">return </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s8">$field </span><span class="s1">= </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_field_data</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">][</span><span class="s3">'postdata'</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">is_array</span><span class="s1">(</span><span class="s8">$field</span><span class="s1">)) 
        { 
            </span><span class="s0">if </span><span class="s1">( ! </span><span class="s2">in_array</span><span class="s1">(</span><span class="s8">$value</span><span class="s4">, </span><span class="s8">$field</span><span class="s1">)) 
            { 
                </span><span class="s0">return </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
        </span><span class="s0">else</span><span class="s1"> 
        { 
            </span><span class="s0">if </span><span class="s1">((</span><span class="s8">$field </span><span class="s1">== </span><span class="s3">'' </span><span class="s0">OR </span><span class="s8">$value </span><span class="s1">== </span><span class="s3">''</span><span class="s1">) </span><span class="s0">OR </span><span class="s1">(</span><span class="s8">$field </span><span class="s1">!= </span><span class="s8">$value</span><span class="s1">)) 
            { 
                </span><span class="s0">return </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
 
        </span><span class="s0">return </span><span class="s3">' checked=&quot;checked&quot;'</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Required 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">required</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s2">is_array</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">)) 
        { 
            </span><span class="s0">return </span><span class="s1">(</span><span class="s2">trim</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) == </span><span class="s3">''</span><span class="s1">) ? </span><span class="s2">FALSE </span><span class="s1">: </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
        } 
        </span><span class="s0">else</span><span class="s1"> 
        { 
            </span><span class="s0">return </span><span class="s1">( ! </span><span class="s0">empty</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
        } 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Match one field to another 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@param   </span><span class="s5">field 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">matches</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$field</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s0">isset</span><span class="s1">(</span><span class="s8">$_POST</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">])) 
        { 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s8">$field </span><span class="s1">= </span><span class="s8">$_POST</span><span class="s1">[</span><span class="s8">$field</span><span class="s1">]</span><span class="s4">;</span><span class="s1"> 
 
        </span><span class="s0">return </span><span class="s1">(</span><span class="s8">$str </span><span class="s1">!== </span><span class="s8">$field</span><span class="s1">) ? </span><span class="s2">FALSE </span><span class="s1">: </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Minimum Length 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@param   </span><span class="s5">value 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">min_length</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$val</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">&quot;/[^0-9]/&quot;</span><span class="s4">, </span><span class="s8">$val</span><span class="s1">)) 
        { 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">function_exists</span><span class="s1">(</span><span class="s3">'mb_strlen'</span><span class="s1">)) 
        { 
            </span><span class="s0">return </span><span class="s1">(</span><span class="s2">mb_strlen</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) &lt; </span><span class="s8">$val</span><span class="s1">) ? </span><span class="s2">FALSE </span><span class="s1">: </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">return </span><span class="s1">(</span><span class="s2">strlen</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) &lt; </span><span class="s8">$val</span><span class="s1">) ? </span><span class="s2">FALSE </span><span class="s1">: </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Max Length 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@param   </span><span class="s5">value 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">max_length</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$val</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">&quot;/[^0-9]/&quot;</span><span class="s4">, </span><span class="s8">$val</span><span class="s1">)) 
        { 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">function_exists</span><span class="s1">(</span><span class="s3">'mb_strlen'</span><span class="s1">)) 
        { 
            </span><span class="s0">return </span><span class="s1">(</span><span class="s2">mb_strlen</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) &gt; </span><span class="s8">$val</span><span class="s1">) ? </span><span class="s2">FALSE </span><span class="s1">: </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">return </span><span class="s1">(</span><span class="s2">strlen</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) &gt; </span><span class="s8">$val</span><span class="s1">) ? </span><span class="s2">FALSE </span><span class="s1">: </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Exact Length 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@param   </span><span class="s5">value 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">exact_length</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$val</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">&quot;/[^0-9]/&quot;</span><span class="s4">, </span><span class="s8">$val</span><span class="s1">)) 
        { 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">function_exists</span><span class="s1">(</span><span class="s3">'mb_strlen'</span><span class="s1">)) 
        { 
            </span><span class="s0">return </span><span class="s1">(</span><span class="s2">mb_strlen</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) != </span><span class="s8">$val</span><span class="s1">) ? </span><span class="s2">FALSE </span><span class="s1">: </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">return </span><span class="s1">(</span><span class="s2">strlen</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) != </span><span class="s8">$val</span><span class="s1">) ? </span><span class="s2">FALSE </span><span class="s1">: </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Valid Email 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">valid_email</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s1">(bool) </span><span class="s2">filter_var</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s2">FILTER_VALIDATE_EMAIL</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Valid Emails 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">valid_emails</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">strpos</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s3">','</span><span class="s1">) === </span><span class="s2">FALSE</span><span class="s1">) 
        { 
            </span><span class="s0">return </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">valid_email</span><span class="s1">(</span><span class="s2">trim</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">foreach</span><span class="s1">(</span><span class="s2">explode</span><span class="s1">(</span><span class="s3">','</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">) </span><span class="s0">as </span><span class="s8">$email</span><span class="s1">) 
        { 
            </span><span class="s0">if </span><span class="s1">(</span><span class="s2">trim</span><span class="s1">(</span><span class="s8">$email</span><span class="s1">) != </span><span class="s3">'' </span><span class="s1">&amp;&amp; </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">valid_email</span><span class="s1">(</span><span class="s2">trim</span><span class="s1">(</span><span class="s8">$email</span><span class="s1">)) === </span><span class="s2">FALSE</span><span class="s1">) 
            { 
                </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
 
        </span><span class="s0">return </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Validate IP Address 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">string 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">valid_ip</span><span class="s1">(</span><span class="s8">$ip</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">input</span><span class="s1">-&gt;</span><span class="s2">valid_ip</span><span class="s1">(</span><span class="s8">$ip</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Alpha 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">alpha</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s1">( ! </span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">&quot;/^([a-z])+$/i&quot;</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)) ? </span><span class="s2">FALSE </span><span class="s1">: </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Alpha-numeric 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">alpha_numeric</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s1">( ! </span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">&quot;/^([a-z0-9])+$/i&quot;</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)) ? </span><span class="s2">FALSE </span><span class="s1">: </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Alpha-numeric with underscores and dashes 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">alpha_dash</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s1">( ! </span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">&quot;/^([-a-z0-9_-])+$/i&quot;</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)) ? </span><span class="s2">FALSE </span><span class="s1">: </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Alpha-numeric with underscores, dashes, and spaces 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">alpha_dash_space</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s1">( ! </span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">&quot;/^([a-z0-9</span><span class="s10">\_\-\s</span><span class="s3">])+$/i&quot;</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)) ? </span><span class="s2">FALSE </span><span class="s1">: </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Numeric 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">numeric</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s1">(bool)</span><span class="s2">preg_match</span><span class="s1">( </span><span class="s3">'/^[\-+]?[0-9]*\.?[0-9]+$/'</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Is Numeric 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">is_numeric</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s1">( ! </span><span class="s2">is_numeric</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">)) ? </span><span class="s2">FALSE </span><span class="s1">: </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Integer 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">integer</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s1">(bool)</span><span class="s2">preg_match</span><span class="s1">( </span><span class="s3">'/^[\-+]?[0-9]+$/'</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
    * Greater than 
    * 
    * </span><span class="s6">@param    </span><span class="s5">string 
    * </span><span class="s6">@param    </span><span class="s5">int 
    * </span><span class="s6">@return   </span><span class="s5">bool 
    */</span><span class="s1"> 
    </span><span class="s0">public function </span><span class="s2">greater_than</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$min</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s2">is_numeric</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) ? (</span><span class="s8">$str </span><span class="s1">&gt; </span><span class="s8">$min</span><span class="s1">) : </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
    * Equal to or Greater than 
    * 
    * </span><span class="s6">@param    </span><span class="s5">string 
    * </span><span class="s6">@param    </span><span class="s5">int 
    * </span><span class="s6">@return   </span><span class="s5">bool 
    */</span><span class="s1"> 
    </span><span class="s0">public function </span><span class="s2">greater_than_equal_to</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$min</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s2">is_numeric</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) ? (</span><span class="s8">$str </span><span class="s1">&gt;= </span><span class="s8">$min</span><span class="s1">) : </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
    * Less than 
    * 
    * </span><span class="s6">@param    </span><span class="s5">string 
    * </span><span class="s6">@param    </span><span class="s5">int 
    * </span><span class="s6">@return   </span><span class="s5">bool 
    */</span><span class="s1"> 
    </span><span class="s0">public function </span><span class="s2">less_than</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$max</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s2">is_numeric</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) ? (</span><span class="s8">$str </span><span class="s1">&lt; </span><span class="s8">$max</span><span class="s1">) : </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
    * Equal to or Less than 
    * 
    * </span><span class="s6">@param    </span><span class="s5">string 
    * </span><span class="s6">@param    </span><span class="s5">int 
    * </span><span class="s6">@return   </span><span class="s5">bool 
    */</span><span class="s1"> 
    </span><span class="s0">public function </span><span class="s2">less_than_equal_to</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s8">$max</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s2">is_numeric</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) ? (</span><span class="s8">$str </span><span class="s1">&lt;= </span><span class="s8">$max</span><span class="s1">) : </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Is a Natural number  (0,1,2,3, etc.) 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">is_natural</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s1">(bool)</span><span class="s2">preg_match</span><span class="s1">( </span><span class="s3">'/^[0-9]+$/'</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Is a Natural number, but not a zero  (1,2,3, etc.) 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">is_natural_no_zero</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">( ! </span><span class="s2">preg_match</span><span class="s1">( </span><span class="s3">'/^[0-9]+$/'</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)) 
        { 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$str </span><span class="s1">== </span><span class="s9">0</span><span class="s1">) 
        { 
            </span><span class="s0">return </span><span class="s2">FALSE</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">return </span><span class="s2">TRUE</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Valid Base64 
     * 
     * Tests a string for characters outside of the Base64 alphabet 
     * as defined by RFC 2045 </span><span class="s6">http://www.faqs.org/rfcs/rfc2045</span><span class="s5"> 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">bool 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">valid_base64</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s1">(bool) ! </span><span class="s2">preg_match</span><span class="s1">(</span><span class="s3">'/[^a-zA-Z0-9\/\+=]/'</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Prep data for form 
     * 
     * This function allows HTML to be safely shown in a form. 
     * Special characters are converted. 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">string 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">prep_for_form</span><span class="s1">(</span><span class="s8">$data </span><span class="s1">= </span><span class="s3">''</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">is_array</span><span class="s1">(</span><span class="s8">$data</span><span class="s1">)) 
        { 
            </span><span class="s0">foreach </span><span class="s1">(</span><span class="s8">$data </span><span class="s0">as </span><span class="s8">$key </span><span class="s1">=&gt; </span><span class="s8">$val</span><span class="s1">) 
            { 
                </span><span class="s8">$data</span><span class="s1">[</span><span class="s8">$key</span><span class="s1">] = </span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">prep_for_form</span><span class="s1">(</span><span class="s8">$val</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
            } 
 
            </span><span class="s0">return </span><span class="s8">$data</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$this</span><span class="s1">-&gt;</span><span class="s2">_safe_form_data </span><span class="s1">== </span><span class="s2">FALSE </span><span class="s0">OR </span><span class="s8">$data </span><span class="s1">=== </span><span class="s3">''</span><span class="s1">) 
        { 
            </span><span class="s0">return </span><span class="s8">$data</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">return </span><span class="s2">str_replace</span><span class="s1">(</span><span class="s0">array</span><span class="s1">(</span><span class="s3">&quot;'&quot;</span><span class="s4">, </span><span class="s3">'&quot;'</span><span class="s4">, </span><span class="s3">'&lt;'</span><span class="s4">, </span><span class="s3">'&gt;'</span><span class="s1">)</span><span class="s4">, </span><span class="s0">array</span><span class="s1">(</span><span class="s3">&quot;&amp;#39;&quot;</span><span class="s4">, </span><span class="s3">&quot;&amp;quot;&quot;</span><span class="s4">, </span><span class="s3">'&amp;lt;'</span><span class="s4">, </span><span class="s3">'&amp;gt;'</span><span class="s1">)</span><span class="s4">, </span><span class="s2">stripslashes</span><span class="s1">(</span><span class="s8">$data</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Prep URL 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">string 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">prep_url</span><span class="s1">(</span><span class="s8">$str </span><span class="s1">= </span><span class="s3">''</span><span class="s1">) 
    { 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s8">$str </span><span class="s1">== </span><span class="s3">'http://' </span><span class="s0">OR </span><span class="s8">$str </span><span class="s1">== </span><span class="s3">''</span><span class="s1">) 
        { 
            </span><span class="s0">return </span><span class="s3">''</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">if </span><span class="s1">(</span><span class="s2">substr</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s9">0</span><span class="s4">, </span><span class="s9">7</span><span class="s1">) != </span><span class="s3">'http://' </span><span class="s1">&amp;&amp; </span><span class="s2">substr</span><span class="s1">(</span><span class="s8">$str</span><span class="s4">, </span><span class="s9">0</span><span class="s4">, </span><span class="s9">8</span><span class="s1">) != </span><span class="s3">'https://'</span><span class="s1">) 
        { 
            </span><span class="s8">$str </span><span class="s1">= </span><span class="s3">'http://'</span><span class="s1">.</span><span class="s8">$str</span><span class="s4">;</span><span class="s1"> 
        } 
 
        </span><span class="s0">return </span><span class="s8">$str</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Strip Image Tags 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">string 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">strip_image_tags</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s2">ee</span><span class="s1">()-&gt;</span><span class="s2">input</span><span class="s1">-&gt;</span><span class="s2">strip_image_tags</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * XSS Clean 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">string 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">xss_clean</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s2">ee</span><span class="s1">(</span><span class="s3">'Security/XSS'</span><span class="s1">)-&gt;</span><span class="s2">clean</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
    } 
 
    </span><span class="s7">// --------------------------------------------------------------------</span><span class="s1"> 
 
    </span><span class="s5">/** 
     * Convert PHP tags to entities 
     * 
     * </span><span class="s6">@access  </span><span class="s5">public 
     * </span><span class="s6">@param   </span><span class="s5">string 
     * </span><span class="s6">@return  </span><span class="s5">string 
     */</span><span class="s1"> 
    </span><span class="s0">function </span><span class="s2">encode_php_tags</span><span class="s1">(</span><span class="s8">$str</span><span class="s1">) 
    { 
        </span><span class="s0">return </span><span class="s2">str_replace</span><span class="s1">(</span><span class="s0">array</span><span class="s1">(</span><span class="s3">'&lt;?php'</span><span class="s4">, </span><span class="s3">'&lt;?PHP'</span><span class="s4">, </span><span class="s3">'&lt;?'</span><span class="s4">, </span><span class="s3">'?&gt;'</span><span class="s4">, </span><span class="s3">'&lt;%'</span><span class="s4">, </span><span class="s3">'%&gt;'</span><span class="s1">)</span><span class="s4">,  </span><span class="s0">array</span><span class="s1">(</span><span class="s3">'&amp;lt;?php'</span><span class="s4">, </span><span class="s3">'&amp;lt;?PHP'</span><span class="s4">, </span><span class="s3">'&amp;lt;?'</span><span class="s4">, </span><span class="s3">'?&amp;gt;'</span><span class="s4">, </span><span class="s3">'&amp;lt;%'</span><span class="s4">, </span><span class="s3">'%&amp;gt;'</span><span class="s1">)</span><span class="s4">, </span><span class="s8">$str</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
    } 
 
} 
 
</span><span class="s7">// EOF</span><span class="s1"> 
</span></pre>
</body>
</html>